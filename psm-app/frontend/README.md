# JavaScript Linting

Run the following to check the style and formatting of the JavaScript files in
the PSM:

    ./gradlew frontend:npm_run_lint

These checks are also run as part of our Jenkins CI tests. (The CI task is
`frontend:npm_run_lint-ci`.)

# JavaScript Dependencies and NPM

We use [Node.js](https://nodejs.org/en/) and [NPM](https://www.npmjs.com/) to
manage our JavaScript dependencies, via a
[Gradle plugin for managing NPM](https://github.com/srs/gradle-node-plugin).

We currently have three categories of JavaScript files in the PSM:

1.  Our own (e.g. script.js) in `frontend/src/main/js`
2.  Third party libraries, not managed by npm (e.g. jquery) in
    `frontend/src/vendor/js`
3.  Third party libraries, managed by npm (e.g. axe-core) from
    `frontend/node_modules`

Gradle moves all the relevant JavaScript files into `cms/js` when building the
app. From there they are downloaded by the browser when a page loads.

The plan is to eventually move all the libraries in category 2 into category 3,
managing them with NPM. That will entail upgrading jQuery since the version
we're currently on is too old and not supported by NPM.
See [issue #626](https://github.com/SolutionGuidance/psm/issues/626).

# Adding Dependencies to NPM

To add 3rd party dependencies, add them to `frontend/package.json`, the file
that tells NPM about our dependencies. Then build the app and NPM will
automatically re-generate `package-lock.json` with details about the new
dependencies.

You will also need to make some edits to the `build.gradle` file so Gradle will
know to handle the new JavaScript files.

See [PR #790](https://github.com/SolutionGuidance/psm/pull/790/) for an example
of adding a JavaScript dependency.

More details: The `package-lock.json` file is automatically generated by NPM
from our `package.json` to "lock in" the specific versions that we are actually
using (and so know they work), to have reproducible builds. It is generated
automatically by doing an `npm install` (or in our case when Gradle does an
`npm install`). It makes sure that two people who run `npm install` get the
same results, no matter how specifically or loosely we specify versions in
`package.json`, and no matter when in time it is run. Although automatically
generated it is
[intended](https://stackoverflow.com/questions/44206782/do-i-commit-the-package-lock-json-file-created-by-npm-5#44210813)
to be committed into version control and that is what we do.
[More information about package-lock.json](https://docs.npmjs.com/files/package-lock.json).

(Some Gradle tasks that might be useful to know about are `frontend:npmSetup`
and `frontend:npmInstall`. They typically don't need to be run manually unless
you are actively doing things with NPM, such as installing new packages during
development.)

# Future Plans

The plan is to eventually add [Webpack](https://webpack.js.org/) or similar to
allow us to split up our JavaScript files into components and then bundle them
back together for the browser to download, and use [Babel](https://babeljs.io/)
to allow us to write ECMAScript 6 or later while still maintaining
compatibility with older browsers.
See [issue #626](https://github.com/SolutionGuidance/psm/issues/626).
